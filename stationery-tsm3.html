<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ö‡∏¥‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô - ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ‡πÑ‡∏ó‡∏¢‡∏ã‡∏¥‡∏ô</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Sarabun', sans-serif; }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .slide-up { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Success Modal Animations */
        .success-bounce {
            animation: successBounce 0.6s ease-out 0.2s both;
        }
        @keyframes successBounce {
            0% { transform: scale(0) rotate(0deg); opacity: 0; }
            50% { transform: scale(1.2) rotate(180deg); opacity: 1; }
            100% { transform: scale(1) rotate(360deg); opacity: 1; }
        }
        
        .success-check {
            animation: checkDraw 0.8s ease-out 0.5s both;
        }
        @keyframes checkDraw {
            0% { stroke-dasharray: 0 50; stroke-dashoffset: 0; }
            100% { stroke-dasharray: 50 50; stroke-dashoffset: 0; }
        }
        
        /* Floating Particles */
        .particle {
            position: absolute;
            width: 8px;
            height: 8px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            animation: float 3s ease-in-out infinite;
        }
        
        .particle-1 { top: 20%; left: 10%; animation-delay: 0s; }
        .particle-2 { top: 30%; right: 15%; animation-delay: 0.5s; }
        .particle-3 { top: 60%; left: 20%; animation-delay: 1s; }
        .particle-4 { top: 70%; right: 25%; animation-delay: 1.5s; }
        .particle-5 { top: 40%; left: 80%; animation-delay: 2s; }
        .particle-6 { top: 80%; right: 10%; animation-delay: 2.5s; }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); opacity: 0.7; }
            25% { transform: translateY(-10px) rotate(90deg); opacity: 1; }
            50% { transform: translateY(-20px) rotate(180deg); opacity: 0.8; }
            75% { transform: translateY(-10px) rotate(270deg); opacity: 1; }
        }
        
        /* Pulse effect for status cards */
        .status-card {
            animation: statusPulse 2s ease-in-out infinite;
        }
        @keyframes statusPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Header -->
    <div class="bg-white shadow-lg border-b-4 border-blue-600">
        <div class="max-w-6xl mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="bg-blue-600 text-white p-3 rounded-lg">
                        <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
                            <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z"/>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-3xl font-bold text-gray-800">‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡πÑ‡∏ó‡∏¢‡∏ã‡∏¥‡∏ô ‡πÅ‡∏°‡∏ô‡∏π‡πÅ‡∏ü‡∏Ñ‡πÄ‡∏à‡∏≠‡∏£‡∏¥‡πà‡∏á ‡∏à‡∏≥‡∏Å‡∏±‡∏î</h1>
                        <p class="text-xl text-gray-700 font-semibold">‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ö‡∏¥‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</p>
                    </div>
                </div>
                <div class="flex space-x-2">
                    <button onclick="showAdminPanel()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition-colors">
                        üìä ‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô
                    </button>
                    <button onclick="showApprovalPanel()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors">
                        ‚úÖ ‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-4xl mx-auto p-6">
        <!-- Main Form -->
        <div id="mainForm" class="bg-white rounded-xl shadow-xl p-8 mb-6">
            <form id="requisitionForm">
                <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÄ‡∏ö‡∏¥‡∏Å -->
                <div class="mb-8">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                        <span class="bg-blue-100 text-blue-600 p-2 rounded-lg mr-3">üë§</span>
                        ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÄ‡∏ö‡∏¥‡∏Å
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• *</label>
                            <input type="text" id="employeeName" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô *</label>
                            <input type="text" id="employeeId" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡πÅ‡∏ú‡∏ô‡∏Å/‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô *</label>
                            <select id="department" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ú‡∏ô‡∏Å</option>
                                <option value="‡∏ù‡πà‡∏≤‡∏¢‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£">‡∏ù‡πà‡∏≤‡∏¢‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£</option>
                                <option value="‡∏ù‡πà‡∏≤‡∏¢ HR">‡∏ù‡πà‡∏≤‡∏¢ HR</option>
                                <option value="‡∏ù‡πà‡∏≤‡∏¢ IT">‡∏ù‡πà‡∏≤‡∏¢ IT</option>
                                <option value="‡∏ù‡πà‡∏≤‡∏¢ CS">‡∏ù‡πà‡∏≤‡∏¢ CS</option>
                                <option value="‡∏ù‡πà‡∏≤‡∏¢ Account">‡∏ù‡πà‡∏≤‡∏¢ Account</option>
                                <option value="‡∏ù‡πà‡∏≤‡∏¢ Cosmetic">‡∏ù‡πà‡∏≤‡∏¢ Cosmetic</option>
                                <option value="‡∏ù‡πà‡∏≤‡∏¢ ‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå‡∏Å‡∏£‡∏∞‡∏ï‡∏¥‡∏Å">‡∏ù‡πà‡∏≤‡∏¢ ‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå‡∏Å‡∏£‡∏∞‡∏ï‡∏¥‡∏Å</option>
                                <option value="‡∏ù‡πà‡∏≤‡∏¢ ‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤">‡∏ù‡πà‡∏≤‡∏¢ ‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</option>
                                <option value="‡∏ù‡πà‡∏≤‡∏¢ ‡∏à‡∏±‡∏î‡∏ã‡∏∑‡πâ‡∏≠">‡∏ù‡πà‡∏≤‡∏¢ ‡∏à‡∏±‡∏î‡∏ã‡∏∑‡πâ‡∏≠</option>
                                <option value="‡∏ù‡πà‡∏≤‡∏¢ ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï">‡∏ù‡πà‡∏≤‡∏¢ ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï</option>
                                <option value="‡∏ù‡πà‡∏≤‡∏¢ ‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°">‡∏ù‡πà‡∏≤‡∏¢ ‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°</option>
                                <option value="‡∏ù‡πà‡∏≤‡∏¢ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û">‡∏ù‡πà‡∏≤‡∏¢ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û</option>
                                <option value="‡∏ù‡πà‡∏≤‡∏¢ ‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡πÅ‡∏•‡∏∞‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå">‡∏ù‡πà‡∏≤‡∏¢ ‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡πÅ‡∏•‡∏∞‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå</option>
                                <option value="‡∏ù‡πà‡∏≤‡∏¢ QMS/RA">‡∏ù‡πà‡∏≤‡∏¢ QMS/RA</option>
                                <option value="‡∏ù‡πà‡∏≤‡∏¢ ‡∏Ç‡∏≤‡∏¢">‡∏ù‡πà‡∏≤‡∏¢ ‡∏Ç‡∏≤‡∏¢</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå -->
                <div class="mb-8">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-xl font-semibold text-gray-800 flex items-center">
                            <span class="bg-green-100 text-green-600 p-2 rounded-lg mr-3">üìù</span>
                            ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô
                        </h2>
                        <button type="button" onclick="addItem()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors flex items-center">
                            <span class="mr-2">+</span> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                        </button>
                    </div>
                    <div id="itemsList" class="space-y-4">
                        <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
                    </div>
                </div>

                <!-- ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå *</label>
                        <select id="purpose" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå</option>
                            <option value="‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥">‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥</option>
                            <option value="‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡πÄ‡∏®‡∏©">‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡πÄ‡∏®‡∏©</option>
                            <option value="‡∏á‡∏≤‡∏ô‡∏î‡πà‡∏ß‡∏ô">‡∏á‡∏≤‡∏ô‡∏î‡πà‡∏ß‡∏ô</option>
                            <option value="‡∏ó‡∏î‡πÅ‡∏ó‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢">‡∏ó‡∏î‡πÅ‡∏ó‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢</option>
                            <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô *</label>
                        <select id="urgency" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô</option>
                            <option value="‡∏õ‡∏Å‡∏ï‡∏¥">‡∏õ‡∏Å‡∏ï‡∏¥ (3-5 ‡∏ß‡∏±‡∏ô)</option>
                            <option value="‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô">‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô (1-2 ‡∏ß‡∏±‡∏ô)</option>
                            <option value="‡∏î‡πà‡∏ß‡∏ô‡∏°‡∏≤‡∏Å">‡∏î‡πà‡∏ß‡∏ô‡∏°‡∏≤‡∏Å (‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ)</option>
                        </select>
                    </div>
                </div>

                <!-- ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ -->
                <div class="mb-8">
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</label>
                    <textarea id="notes" rows="4" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)"></textarea>
                </div>

                <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏™‡πà‡∏á -->
                <div class="flex justify-center">
                    <button type="submit" class="bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white px-8 py-4 rounded-lg text-lg font-semibold transition-all transform hover:scale-105 shadow-lg">
                        üìß ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏ö‡∏¥‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Admin Panel -->
    <div id="adminPanel" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-y-auto">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h2 class="text-2xl font-bold text-gray-800">üìä ‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô</h2>
                        <button onclick="closeAdminPanel()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                    </div>
                </div>
                <div class="p-6">
                    <div class="flex space-x-4 mb-6">
                        <button onclick="showAllRequests()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg">
                            üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÄ‡∏ö‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                        </button>
                        <button onclick="exportToExcel()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg">
                            üìä ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å Excel
                        </button>
                        <button onclick="showStats()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                            üìà ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
                        </button>
                    </div>
                    <div id="adminContent">
                        <div class="text-center py-8 text-gray-500">
                            ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Approval Panel -->
    <div id="approvalPanel" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h2 class="text-2xl font-bold text-gray-800">‚úÖ ‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</h2>
                        <button onclick="closeApprovalPanel()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                    </div>
                </div>
                <div class="p-6">
                    <div class="mb-6">
                        <!-- ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô -->
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                            <h3 class="font-semibold text-blue-800 mb-2">üîê ‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</h3>
                            <div class="text-sm text-blue-700">
                                <p class="mb-2"><strong>‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô:</strong></p>
                                <ol class="list-decimal list-inside space-y-1">
                                    <li>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</li>
                                    <li>‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</li>
                                    <li>‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö"</li>
                                </ol>
                                <p class="mt-2 text-xs">üí° ‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</p>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏≠‡∏µ‡πÄ‡∏°‡∏• *</label>
                                <select id="approvalEmail" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•</option>
                                    <option value="hatairat.k@taisin.co.th">hatairat.k@taisin.co.th</option>
                                    <option value="jidapa.a@taisin.co.th">jidapa.a@taisin.co.th</option>
                                    <option value="thanaphat.n@taisin.co.th">thanaphat.n@taisin.co.th</option>
                                    <option value="ruangchai.c@taisin.co.th">ruangchai.c@taisin.co.th</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô *</label>
                                <input type="password" id="approvalPassword" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
                            </div>
                        </div>
                        <button onclick="loginApproval()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium">
                            üîë ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                        </button>
                    </div>
                    <div id="approvalContent" class="hidden">
                        <div class="text-center py-8 text-gray-500">
                            ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-2xl shadow-2xl max-w-lg w-full slide-up overflow-hidden">
                <!-- Header with gradient background -->
                <div class="bg-gradient-to-r from-green-400 to-blue-500 p-6 text-center relative">
                    <!-- Animated checkmark -->
                    <div class="mx-auto flex items-center justify-center h-20 w-20 rounded-full bg-white mb-4 success-bounce">
                        <svg class="h-10 w-10 text-green-500 success-check" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                        </svg>
                    </div>
                    
                    <!-- Floating particles -->
                    <div class="absolute inset-0 overflow-hidden pointer-events-none">
                        <div class="particle particle-1"></div>
                        <div class="particle particle-2"></div>
                        <div class="particle particle-3"></div>
                        <div class="particle particle-4"></div>
                        <div class="particle particle-5"></div>
                        <div class="particle particle-6"></div>
                    </div>
                    
                    <h3 class="text-2xl font-bold text-white mb-2">üéâ ‡πÄ‡∏ö‡∏¥‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h3>
                    <p class="text-green-100">‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß</p>
                </div>
                
                <!-- Content -->
                <div class="p-6">
                    <div class="space-y-4 mb-6">
                        <!-- Status info -->
                        <div class="flex items-center p-3 bg-blue-50 rounded-lg">
                            <div class="flex-shrink-0">
                                <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                                    <span class="text-blue-600 text-sm">üìã</span>
                                </div>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm font-medium text-blue-900">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</p>
                                <p class="text-xs text-blue-700">‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏à‡πâ‡∏á‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</p>
                            </div>
                        </div>
                        
                        <!-- Next steps -->
                        <div class="flex items-center p-3 bg-yellow-50 rounded-lg">
                            <div class="flex-shrink-0">
                                <div class="w-8 h-8 bg-yellow-100 rounded-full flex items-center justify-center">
                                    <span class="text-yellow-600 text-sm">‚è∞</span>
                                </div>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm font-medium text-yellow-900">‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ</p>
                                <p class="text-xs text-yellow-700">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡∏°‡∏µ‡∏≠‡∏≥‡∏ô‡∏≤‡∏à</p>
                            </div>
                        </div>
                        
                        <!-- Contact info -->
                        <div class="flex items-center p-3 bg-purple-50 rounded-lg">
                            <div class="flex-shrink-0">
                                <div class="w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center">
                                    <span class="text-purple-600 text-sm">üí¨</span>
                                </div>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm font-medium text-purple-900">‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°</p>
                                <p class="text-xs text-purple-700">‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Action buttons -->
                    <div class="flex space-x-3">
                        <button onclick="closeSuccessModal()" class="flex-1 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white px-6 py-3 rounded-lg font-medium transition-all transform hover:scale-105 shadow-lg">
                            ‚úÖ ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÅ‡∏•‡πâ‡∏ß
                        </button>
                        <button onclick="createNewRequest()" class="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 px-6 py-3 rounded-lg font-medium transition-colors">
                            üìù ‡πÄ‡∏ö‡∏¥‡∏Å‡πÉ‡∏´‡∏°‡πà
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô
        const stationeryItems = [
            '‡∏õ‡∏≤‡∏Å‡∏Å‡∏≤‡∏•‡∏π‡∏Å‡∏•‡∏∑‡πà‡∏ô', '‡∏î‡∏¥‡∏ô‡∏™‡∏≠', '‡∏¢‡∏≤‡∏á‡∏•‡∏ö', '‡πÑ‡∏°‡πâ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î', '‡∏Å‡∏ö‡πÄ‡∏´‡∏•‡∏≤', '‡∏Å‡∏£‡∏£‡πÑ‡∏Å‡∏£', '‡∏Å‡∏≤‡∏ß', '‡πÄ‡∏ó‡∏õ', 
            '‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© A4', '‡πÅ‡∏ü‡πâ‡∏°', '‡∏Ñ‡∏•‡∏¥‡∏õ', '‡∏´‡∏°‡∏∏‡∏î', '‡∏™‡∏ï‡∏¥‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå', '‡∏õ‡∏≤‡∏Å‡∏Å‡∏≤‡πÄ‡∏ô‡πâ‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°', '‡∏õ‡∏≤‡∏Å‡∏Å‡∏≤‡πÄ‡∏°‡∏à‡∏¥‡∏Å',
            '‡∏•‡∏ß‡∏î‡πÄ‡∏¢‡πá‡∏ö‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©', '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏¢‡πá‡∏ö‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©', '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏à‡∏≤‡∏∞‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©', '‡∏ã‡∏≠‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£', '‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£', '‡∏≠‡∏∑‡πà‡∏ô‡πÜ'
        ];

        // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
        const approvers = {
            '‡∏ù‡πà‡∏≤‡∏¢ Account': 'hatairat.k@taisin.co.th',
            '‡∏ù‡πà‡∏≤‡∏¢ CS': 'hatairat.k@taisin.co.th',
            '‡∏ù‡πà‡∏≤‡∏¢ ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï': 'jidapa.a@taisin.co.th',
            '‡∏ù‡πà‡∏≤‡∏¢ Cosmetic': 'jidapa.a@taisin.co.th',
            '‡∏ù‡πà‡∏≤‡∏¢ ‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå‡∏Å‡∏£‡∏∞‡∏ï‡∏¥‡∏Å': 'jidapa.a@taisin.co.th',
            '‡∏ù‡πà‡∏≤‡∏¢ ‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤': 'jidapa.a@taisin.co.th',
            '‡∏ù‡πà‡∏≤‡∏¢ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û': 'jidapa.a@taisin.co.th',
            '‡∏ù‡πà‡∏≤‡∏¢ ‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡πÅ‡∏•‡∏∞‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå': 'jidapa.a@taisin.co.th',
            '‡∏ù‡πà‡∏≤‡∏¢ QMS/RA': 'jidapa.a@taisin.co.th',
            '‡∏ù‡πà‡∏≤‡∏¢ ‡∏Ç‡∏≤‡∏¢': 'jidapa.a@taisin.co.th',
            '‡∏ù‡πà‡∏≤‡∏¢ HR': 'thanaphat.n@taisin.co.th',
            '‡∏ù‡πà‡∏≤‡∏¢ ‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°': 'ruangchai.c@taisin.co.th'
        };

        let itemCounter = 0;
        let requisitions = JSON.parse(localStorage.getItem('requisitions') || '[]');

        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÅ‡∏£‡∏Å
        document.addEventListener('DOMContentLoaded', function() {
            addItem();
        });

        function addItem() {
            itemCounter++;
            const itemsContainer = document.getElementById('itemsList');
            const itemDiv = document.createElement('div');
            itemDiv.className = 'bg-gray-50 p-4 rounded-lg border fade-in';
            itemDiv.id = `item-${itemCounter}`;
            
            itemDiv.innerHTML = `
                <div class="flex items-center justify-between mb-3">
                    <h3 class="font-medium text-gray-700">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà ${itemCounter}</h3>
                    ${itemCounter > 1 ? `<button type="button" onclick="removeItem(${itemCounter})" class="text-red-600 hover:text-red-800 text-sm">‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>` : ''}
                </div>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå *</label>
                        <select required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" onchange="toggleOtherInput(this)">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</option>
                            ${stationeryItems.map(item => `<option value="${item}">${item}</option>`).join('')}
                        </select>
                        <input type="text" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏≠‡∏∑‡πà‡∏ô‡πÜ" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent mt-2 hidden other-input">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô *</label>
                        <input type="number" min="1" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏´‡∏ô‡πà‡∏ß‡∏¢ *</label>
                        <select required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢</option>
                            <option value="‡∏ä‡∏¥‡πâ‡∏ô">‡∏ä‡∏¥‡πâ‡∏ô</option>
                            <option value="‡πÅ‡∏û‡πá‡∏Ñ">‡πÅ‡∏û‡πá‡∏Ñ</option>
                            <option value="‡∏Å‡∏•‡πà‡∏≠‡∏á">‡∏Å‡∏•‡πà‡∏≠‡∏á</option>
                            <option value="‡∏´‡πà‡∏≠">‡∏´‡πà‡∏≠</option>
                            <option value="‡∏°‡πâ‡∏ß‡∏ô">‡∏°‡πâ‡∏ß‡∏ô</option>
                            <option value="‡πÄ‡∏•‡πà‡∏°">‡πÄ‡∏•‡πà‡∏°</option>
                            <option value="‡∏≠‡∏±‡∏ô">‡∏≠‡∏±‡∏ô</option>
                        </select>
                    </div>
                </div>
            `;
            
            itemsContainer.appendChild(itemDiv);
        }

        function removeItem(itemId) {
            const itemElement = document.getElementById(`item-${itemId}`);
            if (itemElement) {
                itemElement.remove();
            }
        }

        function toggleOtherInput(selectElement) {
            const otherInput = selectElement.parentElement.querySelector('.other-input');
            if (selectElement.value === '‡∏≠‡∏∑‡πà‡∏ô‡πÜ') {
                otherInput.classList.remove('hidden');
                otherInput.required = true;
                otherInput.focus();
            } else {
                otherInput.classList.add('hidden');
                otherInput.required = false;
                otherInput.value = '';
            }
        }

        function getApproverEmail(department) {
            return approvers[department] || 'admin@taisin.co.th';
        }

        document.getElementById('requisitionForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = {
                id: Date.now(),
                employeeName: document.getElementById('employeeName').value,
                department: document.getElementById('department').value,
                employeeId: document.getElementById('employeeId').value,
                purpose: document.getElementById('purpose').value,
                urgency: document.getElementById('urgency').value,
                notes: document.getElementById('notes').value,
                items: [],
                approver: getApproverEmail(document.getElementById('department').value),
                status: '‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥',
                requestDate: new Date().toLocaleDateString('th-TH'),
                requestTime: new Date().toLocaleTimeString('th-TH')
            };

            // ‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
            const itemElements = document.querySelectorAll('#itemsList > div');
            itemElements.forEach(item => {
                const selects = item.querySelectorAll('select');
                const quantityInput = item.querySelector('input[type="number"]');
                const otherInput = item.querySelector('.other-input');
                
                if (selects[0].value && quantityInput.value && selects[1].value) {
                    let itemName = selects[0].value;
                    
                    // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "‡∏≠‡∏∑‡πà‡∏ô‡πÜ" ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å input field
                    if (itemName === '‡∏≠‡∏∑‡πà‡∏ô‡πÜ' && otherInput && otherInput.value.trim()) {
                        itemName = otherInput.value.trim();
                    }
                    
                    formData.items.push({
                        item: itemName,
                        quantity: parseInt(quantityInput.value),
                        unit: selects[1].value
                    });
                }
            });

            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            requisitions.push(formData);
            localStorage.setItem('requisitions', JSON.stringify(requisitions));

            // ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•
            sendEmail(formData);
            
            // ‡πÅ‡∏™‡∏î‡∏á popup ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
            document.getElementById('successModal').classList.remove('hidden');
            
            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°
            document.getElementById('requisitionForm').reset();
            document.getElementById('itemsList').innerHTML = '';
            itemCounter = 0;
            addItem();
        });

        function sendEmail(data) {
            const subject = `[‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏ö‡∏¥‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå] ${data.employeeName} - ${data.department}`;
            const body = `
‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏ú‡∏π‡πâ‡∏°‡∏µ‡∏≠‡∏≥‡∏ô‡∏≤‡∏à‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥

‡∏°‡∏µ‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏ö‡∏¥‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥

‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ú‡∏π‡πâ‡πÄ‡∏ö‡∏¥‡∏Å:
- ‡∏ä‡∏∑‡πà‡∏≠: ${data.employeeName}
- ‡πÅ‡∏ú‡∏ô‡∏Å: ${data.department}
- ‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô: ${data.employeeId}
- ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≠: ${data.requestDate} ${data.requestTime}

‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå:
${data.items.map(item => `- ${item.item} ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ${item.quantity} ${item.unit}`).join('\n')}

‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå: ${data.purpose}
‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô: ${data.urgency}
‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${data.notes || '‡πÑ‡∏°‡πà‡∏°‡∏µ'}

‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥

‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏±‡∏ö/‡∏Ñ‡πà‡∏∞
            `;

            const mailtoLink = `mailto:${data.approver}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            window.open(mailtoLink);
        }

        function closeSuccessModal() {
            document.getElementById('successModal').classList.add('hidden');
        }

        function createNewRequest() {
            // ‡∏õ‡∏¥‡∏î modal
            document.getElementById('successModal').classList.add('hidden');
            
            // ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡∏Ç‡∏≠‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
            document.getElementById('mainForm').scrollIntoView({ 
                behavior: 'smooth', 
                block: 'start' 
            });
            
            // ‡πÄ‡∏ô‡πâ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•
            setTimeout(() => {
                document.getElementById('employeeName').focus();
            }, 500);
        }

        function showAdminPanel() {
            document.getElementById('adminPanel').classList.remove('hidden');
        }

        function closeAdminPanel() {
            document.getElementById('adminPanel').classList.add('hidden');
        }

        function showApprovalPanel() {
            document.getElementById('approvalPanel').classList.remove('hidden');
        }

        function closeApprovalPanel() {
            document.getElementById('approvalPanel').classList.add('hidden');
            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î panel
            logoutApproval();
        }

        function logoutApproval() {
            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°
            document.getElementById('approvalEmail').value = '';
            document.getElementById('approvalPassword').value = '';
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡πà‡∏ß‡∏ô login ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤
            const loginSection = document.querySelector('#approvalPanel .mb-6');
            if (loginSection) {
                loginSection.style.display = 'block';
            }
            
            // ‡∏ã‡πà‡∏≠‡∏ô‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
            document.getElementById('approvalContent').classList.add('hidden');
            document.getElementById('approvalContent').innerHTML = '<div class="text-center py-8 text-gray-500">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ</div>';
            
            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£
            currentApproverEmail = '';
        }

        function loginApproval() {
            const email = document.getElementById('approvalEmail').value;
            const password = document.getElementById('approvalPassword').value;
            
            console.log('Login attempt:', { email, password }); // Debug log
            
            const validEmails = [
                'hatairat.k@taisin.co.th',
                'jidapa.a@taisin.co.th', 
                'thanaphat.n@taisin.co.th',
                'ruangchai.c@taisin.co.th'
            ];
            
            if (!email) {
                alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•');
                return;
            }
            
            if (!password) {
                alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô');
                return;
            }
            
            if (!validEmails.includes(email)) {
                alert('‚ùå ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á\n‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ:\n- hatairat.k@taisin.co.th\n- jidapa.a@taisin.co.th\n- thanaphat.n@taisin.co.th\n- ruangchai.c@taisin.co.th');
                return;
            }
            
            if (password !== '123456') {
                alert('‚ùå ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á\n‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á: 123456');
                return;
            }
            
            // Login ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
            alert('‚úÖ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
            document.getElementById('approvalContent').classList.remove('hidden');
            
            // ‡∏ã‡πà‡∏≠‡∏ô‡∏™‡πà‡∏ß‡∏ô login
            document.querySelector('#approvalPanel .mb-6').style.display = 'none';
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô
            const userInfo = document.createElement('div');
            userInfo.className = 'bg-green-50 border border-green-200 rounded-lg p-3 mb-4';
            userInfo.innerHTML = `
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <span class="text-green-600 mr-2">üë§</span>
                        <span class="text-green-800 font-medium">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß: ${email}</span>
                    </div>
                    <button onclick="logoutApproval()" class="text-red-600 hover:text-red-800 text-sm">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
                </div>
            `;
            document.getElementById('approvalContent').insertBefore(userInfo, document.getElementById('approvalContent').firstChild);
            
            loadPendingRequests(email);
        }

        let currentApproverEmail = '';

        function loadPendingRequests(approverEmail) {
            currentApproverEmail = approverEmail;
            const pendingRequests = requisitions.filter(req => req.status === '‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥' && req.approver === approverEmail);
            const content = document.getElementById('approvalContent');
            
            if (pendingRequests.length === 0) {
                content.innerHTML = '<div class="text-center py-8 text-gray-500">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ</div>';
                return;
            }

            content.innerHTML = pendingRequests.map(req => `
                <div class="border rounded-lg p-4 mb-4">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h3 class="font-semibold">${req.employeeName} - ${req.department}</h3>
                            <p class="text-sm text-gray-600">‡∏£‡∏´‡∏±‡∏™: ${req.employeeId} | ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${req.requestDate}</p>
                        </div>
                        <span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded text-sm">${req.status}</span>
                    </div>
                    <div class="mb-3">
                        <strong>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£:</strong>
                        <ul class="list-disc list-inside ml-4">
                            ${req.items.map(item => `<li>${item.item} ${item.quantity} ${item.unit}</li>`).join('')}
                        </ul>
                    </div>
                    <div class="mb-3">
                        <strong>‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå:</strong> ${req.purpose}<br>
                        <strong>‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô:</strong> ${req.urgency}
                        ${req.notes ? `<br><strong>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong> ${req.notes}` : ''}
                    </div>
                    <div class="flex space-x-2">
                        <button onclick="approveRequest(${req.id})" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded text-sm">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
                        <button onclick="rejectRequest(${req.id})" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded text-sm">‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
                    </div>
                </div>
            `).join('');
        }

        function approveRequest(id) {
            const index = requisitions.findIndex(req => req.id === id);
            if (index !== -1) {
                requisitions[index].status = '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß';
                requisitions[index].approvedDate = new Date().toLocaleDateString('th-TH');
                localStorage.setItem('requisitions', JSON.stringify(requisitions));
                loadPendingRequests(currentApproverEmail);
                alert('‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
            }
        }

        function rejectRequest(id) {
            const reason = prompt('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥:');
            if (reason) {
                const index = requisitions.findIndex(req => req.id === id);
                if (index !== -1) {
                    requisitions[index].status = '‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥';
                    requisitions[index].rejectReason = reason;
                    requisitions[index].rejectedDate = new Date().toLocaleDateString('th-TH');
                    localStorage.setItem('requisitions', JSON.stringify(requisitions));
                    loadPendingRequests(currentApproverEmail);
                    alert('‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                }
            }
        }

        function exportToExcel() {
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            if (requisitions.length === 0) {
                // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                const sampleData = [
                    {
                        id: 1,
                        employeeName: '‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ',
                        department: '‡∏ù‡πà‡∏≤‡∏¢ IT',
                        employeeId: 'IT001',
                        purpose: '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥',
                        urgency: '‡∏õ‡∏Å‡∏ï‡∏¥',
                        notes: '‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô',
                        items: [
                            { item: '‡∏õ‡∏≤‡∏Å‡∏Å‡∏≤‡∏•‡∏π‡∏Å‡∏•‡∏∑‡πà‡∏ô', quantity: 5, unit: '‡∏ä‡∏¥‡πâ‡∏ô' },
                            { item: '‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© A4', quantity: 1, unit: '‡πÅ‡∏û‡πá‡∏Ñ' }
                        ],
                        approver: 'thanaphat.n@taisin.co.th',
                        status: '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß',
                        requestDate: new Date().toLocaleDateString('th-TH'),
                        requestTime: new Date().toLocaleTimeString('th-TH')
                    },
                    {
                        id: 2,
                        employeeName: '‡∏™‡∏°‡∏´‡∏ç‡∏¥‡∏á ‡∏£‡∏±‡∏Å‡∏á‡∏≤‡∏ô',
                        department: '‡∏ù‡πà‡∏≤‡∏¢ HR',
                        employeeId: 'HR002',
                        purpose: '‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡πÄ‡∏®‡∏©',
                        urgency: '‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô',
                        notes: '‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏™‡∏±‡∏°‡∏°‡∏ô‡∏≤',
                        items: [
                            { item: '‡πÅ‡∏ü‡πâ‡∏°', quantity: 10, unit: '‡πÄ‡∏•‡πà‡∏°' },
                            { item: '‡∏õ‡∏≤‡∏Å‡∏Å‡∏≤‡πÄ‡∏ô‡πâ‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°', quantity: 3, unit: '‡∏ä‡∏¥‡πâ‡∏ô' }
                        ],
                        approver: 'thanaphat.n@taisin.co.th',
                        status: '‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥',
                        requestDate: new Date().toLocaleDateString('th-TH'),
                        requestTime: new Date().toLocaleTimeString('th-TH')
                    }
                ];
                
                alert('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì');
                createExcelFile(sampleData);
                return;
            }

            createExcelFile(requisitions);
        }

        function createExcelFile(data, dateRange = null) {
            try {
                // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•
                const exportButton = document.querySelector('button[onclick="exportToExcel()"]');
                const originalText = exportButton.innerHTML;
                exportButton.innerHTML = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå...';
                exportButton.disabled = true;

                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ XLSX library ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
                if (typeof XLSX === 'undefined') {
                    throw new Error('‡πÑ‡∏•‡∏ö‡∏£‡∏≤‡∏£‡∏µ XLSX ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÇ‡∏´‡∏•‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà');
                }

                console.log('‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå Excel...', { dataLength: data.length });

                // ‡∏™‡∏£‡πâ‡∏≤‡∏á workbook
                const wb = XLSX.utils.book_new();

                // Sheet 1: ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î)
                const ws_data = [
                    ['‡∏•‡∏≥‡∏î‡∏±‡∏ö', '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà', '‡πÄ‡∏ß‡∏•‡∏≤', '‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•', '‡πÅ‡∏ú‡∏ô‡∏Å', '‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô', '‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£', '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô', '‡∏´‡∏ô‡πà‡∏ß‡∏¢', '‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå', '‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô', '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞', '‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥', '‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏']
                ];

                let rowNumber = 1;
                data.forEach(req => {
                    req.items.forEach((item, index) => {
                        ws_data.push([
                            index === 0 ? rowNumber : '', // ‡πÅ‡∏™‡∏î‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÅ‡∏ñ‡∏ß‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏≥‡∏Ç‡∏≠
                            index === 0 ? req.requestDate : '',
                            index === 0 ? req.requestTime : '',
                            index === 0 ? req.employeeName : '',
                            index === 0 ? req.department : '',
                            index === 0 ? req.employeeId : '',
                            item.item,
                            item.quantity,
                            item.unit,
                            index === 0 ? req.purpose : '',
                            index === 0 ? req.urgency : '',
                            index === 0 ? req.status : '',
                            index === 0 ? req.approver : '',
                            index === 0 ? (req.notes || '') : ''
                        ]);
                    });
                    rowNumber++;
                });

                const ws1 = XLSX.utils.aoa_to_sheet(ws_data);
                
                // ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå
                ws1['!cols'] = [
                    { wch: 8 },   // ‡∏•‡∏≥‡∏î‡∏±‡∏ö
                    { wch: 12 },  // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
                    { wch: 10 },  // ‡πÄ‡∏ß‡∏•‡∏≤
                    { wch: 20 },  // ‡∏ä‡∏∑‡πà‡∏≠
                    { wch: 25 },  // ‡πÅ‡∏ú‡∏ô‡∏Å
                    { wch: 12 },  // ‡∏£‡∏´‡∏±‡∏™
                    { wch: 25 },  // ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                    { wch: 8 },   // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô
                    { wch: 8 },   // ‡∏´‡∏ô‡πà‡∏ß‡∏¢
                    { wch: 15 },  // ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå
                    { wch: 12 },  // ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô
                    { wch: 12 },  // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
                    { wch: 25 },  // ‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
                    { wch: 30 }   // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏
                ];

                XLSX.utils.book_append_sheet(wb, ws1, '‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î');

                // Sheet 2: ‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
                const stats = {
                    total: data.length,
                    pending: data.filter(r => r.status === '‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥').length,
                    approved: data.filter(r => r.status === '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß').length,
                    rejected: data.filter(r => r.status === '‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥').length
                };

                const uniqueRequesters = new Set(data.map(req => req.employeeId));
                const totalRequesters = uniqueRequesters.size;

                // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                const totalItems = data.reduce((sum, req) => sum + req.items.length, 0);

                const stats_data = [
                    ['‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô', ''],
                    ['‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡πÑ‡∏ó‡∏¢‡∏ã‡∏¥‡∏ô ‡πÅ‡∏°‡∏ô‡∏π‡πÅ‡∏ü‡∏Ñ‡πÄ‡∏à‡∏≠‡∏£‡∏¥‡πà‡∏á ‡∏à‡∏≥‡∏Å‡∏±‡∏î', ''],
                    ['‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô: ' + new Date().toLocaleDateString('th-TH'), ''],
                    ['', ''],
                    ['‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ', ''],
                    ['‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£', '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô'],
                    ['‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î', stats.total],
                    ['‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î', totalItems],
                    ['‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏ö‡∏¥‡∏Å (‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥)', totalRequesters],
                    ['', ''],
                    ['‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏≥‡∏Ç‡∏≠', ''],
                    ['‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥', stats.pending],
                    ['‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß', stats.approved],
                    ['‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥', stats.rejected],
                    ['', ''],
                    ['‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô‡∏Å', ''],
                    ['‡πÅ‡∏ú‡∏ô‡∏Å', '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏≥‡∏Ç‡∏≠', '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏ö‡∏¥‡∏Å']
                ];

                const departmentStats = {};
                const requestersByDept = {};
                
                data.forEach(req => {
                    departmentStats[req.department] = (departmentStats[req.department] || 0) + 1;
                    
                    if (!requestersByDept[req.department]) {
                        requestersByDept[req.department] = new Set();
                    }
                    requestersByDept[req.department].add(req.employeeId);
                });

                Object.entries(departmentStats)
                    .sort((a, b) => b[1] - a[1]) // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏à‡∏≤‡∏Å‡∏°‡∏≤‡∏Å‡πÑ‡∏õ‡∏ô‡πâ‡∏≠‡∏¢
                    .forEach(([dept, count]) => {
                        stats_data.push([dept, count, requestersByDept[dept].size]);
                    });

                const ws2 = XLSX.utils.aoa_to_sheet(stats_data);
                ws2['!cols'] = [{ wch: 35 }, { wch: 15 }, { wch: 15 }];
                XLSX.utils.book_append_sheet(wb, ws2, '‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥');

                // Sheet 3: ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°
                const itemStats = {};
                data.forEach(req => {
                    req.items.forEach(item => {
                        if (!itemStats[item.item]) {
                            itemStats[item.item] = { count: 0, totalQty: 0, units: new Set() };
                        }
                        itemStats[item.item].count += 1;
                        itemStats[item.item].totalQty += item.quantity;
                        itemStats[item.item].units.add(item.unit);
                    });
                });

                const popular_data = [
                    ['‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°', '', '', ''],
                    ['‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏ö‡∏¥‡∏Å', '', '', ''],
                    ['', '', '', ''],
                    ['‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö', '‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£', '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏ö‡∏¥‡∏Å', '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏ß‡∏°', '‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ']
                ];

                Object.entries(itemStats)
                    .sort((a, b) => b[1].count - a[1].count)
                    .forEach(([item, data], index) => {
                        popular_data.push([
                            index + 1,
                            item, 
                            data.count, 
                            data.totalQty,
                            Array.from(data.units).join(', ')
                        ]);
                    });

                const ws3 = XLSX.utils.aoa_to_sheet(popular_data);
                ws3['!cols'] = [{ wch: 8 }, { wch: 25 }, { wch: 15 }, { wch: 12 }, { wch: 15 }];
                XLSX.utils.book_append_sheet(wb, ws3, '‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°');

                // Sheet 4: ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
                const status_data = [
                    ['‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞', '', '', '', ''],
                    ['', '', '', '', ''],
                    ['‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞', '‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•', '‡πÅ‡∏ú‡∏ô‡∏Å', '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≠', '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£']
                ];

                ['‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥', '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß', '‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥'].forEach(status => {
                    const statusRequests = data.filter(req => req.status === status);
                    if (statusRequests.length > 0) {
                        status_data.push(['', '', '', '', '']); // ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ß‡πà‡∏≤‡∏á
                        statusRequests.forEach(req => {
                            status_data.push([
                                req.status,
                                req.employeeName,
                                req.department,
                                req.requestDate,
                                req.items.length
                            ]);
                        });
                    }
                });

                const ws4 = XLSX.utils.aoa_to_sheet(status_data);
                ws4['!cols'] = [{ wch: 12 }, { wch: 20 }, { wch: 25 }, { wch: 12 }, { wch: 12 }];
                XLSX.utils.book_append_sheet(wb, ws4, '‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞');

                // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå
                const now = new Date();
                const dateStr = now.toLocaleDateString('th-TH').replace(/\//g, '-');
                const timeStr = now.toLocaleTimeString('th-TH', { hour12: false }).replace(/:/g, '-');
                
                let fileName;
                if (dateRange) {
                    fileName = `‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏ö‡∏¥‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå_${dateRange.start.replace(/\//g, '-')}_‡∏ñ‡∏∂‡∏á_${dateRange.end.replace(/\//g, '-')}_${timeStr}.xlsx`;
                } else {
                    fileName = `‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏ö‡∏¥‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå_${dateStr}_${timeStr}.xlsx`;
                }
                
                console.log('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå:', fileName);
                
                // ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå
                try {
                    XLSX.writeFile(wb, fileName);
                    console.log('‡πÑ‡∏ü‡∏•‡πå‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                    
                    // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥
                    setTimeout(() => {
                        const message = `‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå Excel ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!\n\nüìÅ ‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå: ${fileName}\n\nüìä ‡πÑ‡∏ü‡∏•‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢ 4 Sheet:\n‚Ä¢ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (${ws_data.length - 1} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)\n‚Ä¢ ‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥\n‚Ä¢ ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°\n‚Ä¢ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞\n\nüîç ‡∏ß‡∏¥‡∏ò‡∏µ‡∏´‡∏≤‡πÑ‡∏ü‡∏•‡πå:\n1. ‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå Downloads\n2. ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡∏°‡πà‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î\n3. ‡∏´‡∏≤‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢ "‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏ö‡∏¥‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå"\n\nüí° ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÑ‡∏ü‡∏•‡πå ‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏ó‡∏µ‡πà‡πÅ‡∏ñ‡∏ö‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡∏≠‡∏á‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå`;
                        
                        alert(message);
                        
                        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÉ‡∏ô‡∏Ñ‡∏≠‡∏ô‡πÇ‡∏ã‡∏•
                        console.log('‡πÑ‡∏ü‡∏•‡πå‡∏Ñ‡∏ß‡∏£‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà:', navigator.userAgent.includes('Windows') ? 
                            'C:\\Users\\[‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ]\\Downloads\\' : 
                            '~/Downloads/');
                        
                        // ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏î‡∏¥‡∏°
                        exportButton.innerHTML = originalText;
                        exportButton.disabled = false;
                    }, 500);
                    
                } catch (writeError) {
                    console.error('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÑ‡∏ü‡∏•‡πå:', writeError);
                    throw new Error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏î‡πâ ‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î');
                }

            } catch (error) {
                console.error('Error creating Excel file:', error);
                alert(`‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå Excel\n\n‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î: ${error.message}\n\nüí° ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:\n‚Ä¢ ‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏õ‡∏∏‡πà‡∏° "üß™ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î" ‡∏Å‡πà‡∏≠‡∏ô\n‚Ä¢ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î\n‚Ä¢ ‡∏•‡∏≠‡∏á‡∏õ‡∏¥‡∏î Pop-up Blocker`);
                
                // ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏î‡∏¥‡∏°
                exportButton.innerHTML = originalText;
                exportButton.disabled = false;
            }
        }

        function showAllRequests() {
            const content = document.getElementById('adminContent');
            
            if (requisitions.length === 0) {
                content.innerHTML = `
                    <div class="text-center py-12">
                        <div class="text-6xl mb-4">üìã</div>
                        <h3 class="text-xl font-semibold text-gray-700 mb-2">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</h3>
                        <p class="text-gray-500">‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</p>
                    </div>
                `;
                return;
            }

            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏ß‡∏°
            const totalRequests = requisitions.length;
            const pendingCount = requisitions.filter(req => req.status === '‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥').length;
            const approvedCount = requisitions.filter(req => req.status === '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß').length;
            const rejectedCount = requisitions.filter(req => req.status === '‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥').length;
            const uniqueRequesters = new Set(requisitions.map(req => req.employeeId)).size;

            content.innerHTML = `
                <!-- ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏ß‡∏° -->
                <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-6">
                    <div class="bg-blue-100 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-blue-600">${totalRequests}</div>
                        <div class="text-sm text-blue-800">‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                    </div>
                    <div class="bg-purple-100 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-purple-600">${uniqueRequesters}</div>
                        <div class="text-sm text-purple-800">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏ö‡∏¥‡∏Å</div>
                    </div>
                    <div class="bg-yellow-100 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-yellow-600">${pendingCount}</div>
                        <div class="text-sm text-yellow-800">‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</div>
                    </div>
                    <div class="bg-green-100 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-green-600">${approvedCount}</div>
                        <div class="text-sm text-green-800">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</div>
                    </div>
                    <div class="bg-red-100 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-red-600">${rejectedCount}</div>
                        <div class="text-sm text-red-800">‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</div>
                    </div>
                </div>

                <!-- ‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ -->
                <div class="bg-gray-50 p-4 rounded-lg mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠</label>
                            <input type="text" id="searchName" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" onkeyup="filterRequests()">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡πÅ‡∏ú‡∏ô‡∏Å</label>
                            <select id="filterDepartment" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" onchange="filterRequests()">
                                <option value="">‡∏ó‡∏∏‡∏Å‡πÅ‡∏ú‡∏ô‡∏Å</option>
                                ${[...new Set(requisitions.map(req => req.department))].sort().map(dept => 
                                    `<option value="${dept}">${dept}</option>`
                                ).join('')}
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label>
                            <select id="filterStatus" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" onchange="filterRequests()">
                                <option value="">‡∏ó‡∏∏‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</option>
                                <option value="‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥">‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</option>
                                <option value="‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</option>
                                <option value="‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥">‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</option>
                            </select>
                        </div>
                        <div class="flex items-end">
                            <button onclick="clearFilters()" class="w-full bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg">
                                üîÑ ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÄ‡∏ö‡∏¥‡∏Å -->
                <div class="bg-white rounded-lg shadow overflow-hidden">
                    <div class="px-6 py-4 bg-gray-50 border-b">
                        <h3 class="text-lg font-semibold text-gray-800">üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÄ‡∏ö‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
                    </div>
                    <div id="requestsList" class="divide-y divide-gray-200">
                        ${generateRequestsList(requisitions)}
                    </div>
                </div>
            `;
        }

        function generateRequestsList(requests) {
            if (requests.length === 0) {
                return '<div class="p-6 text-center text-gray-500">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç</div>';
            }

            return requests
                .sort((a, b) => new Date(b.requestDate.split('/').reverse().join('-')) - new Date(a.requestDate.split('/').reverse().join('-')))
                .map(req => {
                    const statusColor = {
                        '‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥': 'bg-yellow-100 text-yellow-800',
                        '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß': 'bg-green-100 text-green-800',
                        '‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥': 'bg-red-100 text-red-800'
                    };

                    const statusIcon = {
                        '‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥': '‚è≥',
                        '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß': '‚úÖ',
                        '‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥': '‚ùå'
                    };

                    return `
                        <div class="p-6 hover:bg-gray-50 transition-colors">
                            <div class="flex items-start justify-between mb-4">
                                <div class="flex-1">
                                    <div class="flex items-center mb-2">
                                        <h4 class="text-lg font-semibold text-gray-900 mr-3">${req.employeeName}</h4>
                                        <span class="px-3 py-1 rounded-full text-sm font-medium ${statusColor[req.status]}">
                                            ${statusIcon[req.status]} ${req.status}
                                        </span>
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-gray-600">
                                        <div>
                                            <span class="font-medium">‡πÅ‡∏ú‡∏ô‡∏Å:</span> ${req.department}
                                        </div>
                                        <div>
                                            <span class="font-medium">‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô:</span> ${req.employeeId}
                                        </div>
                                        <div>
                                            <span class="font-medium">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ö‡∏¥‡∏Å:</span> ${req.requestDate}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <h5 class="font-medium text-gray-900 mb-2">üìù ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå (${req.items.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</h5>
                                    <div class="bg-gray-50 rounded-lg p-3">
                                        ${req.items.map(item => `
                                            <div class="flex justify-between py-1">
                                                <span class="text-gray-700">${item.item}</span>
                                                <span class="font-medium text-gray-900">${item.quantity} ${item.unit}</span>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                                
                                <div>
                                    <h5 class="font-medium text-gray-900 mb-2">‚ÑπÔ∏è ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</h5>
                                    <div class="space-y-2 text-sm">
                                        <div>
                                            <span class="font-medium text-gray-700">‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå:</span>
                                            <span class="text-gray-600">${req.purpose}</span>
                                        </div>
                                        <div>
                                            <span class="font-medium text-gray-700">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô:</span>
                                            <span class="text-gray-600">${req.urgency}</span>
                                        </div>
                                        <div>
                                            <span class="font-medium text-gray-700">‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥:</span>
                                            <span class="text-gray-600">${req.approver}</span>
                                        </div>
                                        ${req.notes ? `
                                            <div>
                                                <span class="font-medium text-gray-700">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</span>
                                                <span class="text-gray-600">${req.notes}</span>
                                            </div>
                                        ` : ''}
                                        ${req.rejectReason ? `
                                            <div>
                                                <span class="font-medium text-red-700">‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥:</span>
                                                <span class="text-red-600">${req.rejectReason}</span>
                                            </div>
                                        ` : ''}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
        }

        function filterRequests() {
            const searchName = document.getElementById('searchName').value.toLowerCase();
            const filterDepartment = document.getElementById('filterDepartment').value;
            const filterStatus = document.getElementById('filterStatus').value;

            const filteredRequests = requisitions.filter(req => {
                const matchName = req.employeeName.toLowerCase().includes(searchName);
                const matchDepartment = !filterDepartment || req.department === filterDepartment;
                const matchStatus = !filterStatus || req.status === filterStatus;
                
                return matchName && matchDepartment && matchStatus;
            });

            document.getElementById('requestsList').innerHTML = generateRequestsList(filteredRequests);
        }

        function clearFilters() {
            document.getElementById('searchName').value = '';
            document.getElementById('filterDepartment').value = '';
            document.getElementById('filterStatus').value = '';
            filterRequests();
        }

        function showStats() {
            document.getElementById('adminContent').innerHTML = `
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                    <h3 class="font-semibold text-blue-800 mb-4">üìÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</h3>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</label>
                            <input type="date" id="startDate" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</label>
                            <input type="date" id="endDate" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏î‡πà‡∏ß‡∏ô</label>
                            <select id="quickRange" onchange="setQuickRange()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤</option>
                                <option value="today">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</option>
                                <option value="yesterday">‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏ô</option>
                                <option value="thisWeek">‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ</option>
                                <option value="lastWeek">‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß</option>
                                <option value="thisMonth">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</option>
                                <option value="lastMonth">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß</option>
                                <option value="last7days">7 ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤</option>
                                <option value="last30days">30 ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤</option>
                                <option value="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                            </select>
                        </div>
                        <div>
                            <button onclick="generateStats()" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium">
                                üìä ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
                            </button>
                        </div>
                    </div>
                </div>
                <div id="statsResults">
                    <div class="text-center py-8 text-gray-500">
                        ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏•‡∏∞‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
                    </div>
                </div>
            `;

            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (30 ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤)
            const today = new Date();
            const thirtyDaysAgo = new Date(today.getTime() - (30 * 24 * 60 * 60 * 1000));
            
            document.getElementById('endDate').value = today.toISOString().split('T')[0];
            document.getElementById('startDate').value = thirtyDaysAgo.toISOString().split('T')[0];
            document.getElementById('quickRange').value = 'last30days';
        }

        function setQuickRange() {
            const quickRange = document.getElementById('quickRange').value;
            const today = new Date();
            let startDate, endDate;

            switch(quickRange) {
                case 'today':
                    startDate = endDate = today;
                    break;
                case 'yesterday':
                    const yesterday = new Date(today.getTime() - (24 * 60 * 60 * 1000));
                    startDate = endDate = yesterday;
                    break;
                case 'thisWeek':
                    const startOfWeek = new Date(today);
                    startOfWeek.setDate(today.getDate() - today.getDay());
                    startDate = startOfWeek;
                    endDate = today;
                    break;
                case 'lastWeek':
                    const lastWeekEnd = new Date(today.getTime() - (today.getDay() * 24 * 60 * 60 * 1000));
                    const lastWeekStart = new Date(lastWeekEnd.getTime() - (6 * 24 * 60 * 60 * 1000));
                    startDate = lastWeekStart;
                    endDate = lastWeekEnd;
                    break;
                case 'thisMonth':
                    startDate = new Date(today.getFullYear(), today.getMonth(), 1);
                    endDate = today;
                    break;
                case 'lastMonth':
                    const lastMonth = new Date(today.getFullYear(), today.getMonth() - 1, 1);
                    const lastMonthEnd = new Date(today.getFullYear(), today.getMonth(), 0);
                    startDate = lastMonth;
                    endDate = lastMonthEnd;
                    break;
                case 'last7days':
                    startDate = new Date(today.getTime() - (7 * 24 * 60 * 60 * 1000));
                    endDate = today;
                    break;
                case 'last30days':
                    startDate = new Date(today.getTime() - (30 * 24 * 60 * 60 * 1000));
                    endDate = today;
                    break;
                case 'all':
                    // ‡∏´‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÅ‡∏•‡∏∞‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                    if (requisitions.length > 0) {
                        const dates = requisitions.map(req => new Date(req.requestDate.split('/').reverse().join('-')));
                        startDate = new Date(Math.min(...dates));
                        endDate = new Date(Math.max(...dates));
                    } else {
                        startDate = new Date(today.getTime() - (365 * 24 * 60 * 60 * 1000));
                        endDate = today;
                    }
                    break;
                default:
                    return;
            }

            document.getElementById('startDate').value = startDate.toISOString().split('T')[0];
            document.getElementById('endDate').value = endDate.toISOString().split('T')[0];
        }

        function generateStats() {
            const startDateStr = document.getElementById('startDate').value;
            const endDateStr = document.getElementById('endDate').value;

            if (!startDateStr || !endDateStr) {
                alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î');
                return;
            }

            const startDate = new Date(startDateStr);
            const endDate = new Date(endDateStr + 'T23:59:59'); // ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î

            if (startDate > endDate) {
                alert('‚ùå ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î');
                return;
            }

            // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á ‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
            let dataToUse = requisitions;
            if (requisitions.length === 0) {
                dataToUse = createSampleData();
                alert('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏´‡πâ‡∏î‡∏π');
            }

            // ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤
            const filteredRequisitions = dataToUse.filter(req => {
                // ‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏≤‡∏Å dd/mm/yyyy ‡πÄ‡∏õ‡πá‡∏ô Date object
                const dateParts = req.requestDate.split('/');
                if (dateParts.length !== 3) return false;
                
                const [day, month, year] = dateParts;
                const reqDate = new Date(parseInt(year), parseInt(month) - 1, parseInt(day));
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
                if (isNaN(reqDate.getTime())) return false;
                
                return reqDate >= startDate && reqDate <= endDate;
            });

            if (filteredRequisitions.length === 0) {
                document.getElementById('statsResults').innerHTML = `
                    <div class="text-center py-8">
                        <div class="text-gray-500 mb-4">üìä ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</div>
                        <div class="text-sm text-gray-400">
                            ‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤: ${startDate.toLocaleDateString('th-TH')} - ${endDate.toLocaleDateString('th-TH')}
                        </div>
                        <button onclick="generateSampleReport()" class="mt-4 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                            üìä ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
                        </button>
                    </div>
                `;
                return;
            }

            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß
            const stats = {
                total: filteredRequisitions.length,
                pending: filteredRequisitions.filter(r => r.status === '‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥').length,
                approved: filteredRequisitions.filter(r => r.status === '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß').length,
                rejected: filteredRequisitions.filter(r => r.status === '‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥').length
            };

            // ‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏ö‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ô
            const uniqueRequesters = new Set(filteredRequisitions.map(req => req.employeeId));
            const totalRequesters = uniqueRequesters.size;

            const departmentStats = {};
            const requestersByDept = {};
            
            filteredRequisitions.forEach(req => {
                departmentStats[req.department] = (departmentStats[req.department] || 0) + 1;
                
                if (!requestersByDept[req.department]) {
                    requestersByDept[req.department] = new Set();
                }
                requestersByDept[req.department].add(req.employeeId);
            });

            // ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°
            const itemStats = {};
            filteredRequisitions.forEach(req => {
                req.items.forEach(item => {
                    itemStats[item.item] = (itemStats[item.item] || 0) + item.quantity;
                });
            });

            const topItems = Object.entries(itemStats)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);

            // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
            document.getElementById('statsResults').innerHTML = `
                <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å -->
                <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold text-green-800">üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</h3>
                            <p class="text-sm text-green-700">‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤: ${startDate.toLocaleDateString('th-TH')} - ${endDate.toLocaleDateString('th-TH')}</p>
                        </div>
                        <div class="text-right">
                            <div class="text-sm text-green-600">‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>
                            <div class="text-lg font-bold text-green-800">${filteredRequisitions.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
                            <button onclick="exportFilteredData()" class="mt-2 bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm">
                                üìä ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å Excel
                            </button>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6">
                    <div class="bg-blue-100 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-blue-600">${stats.total}</div>
                        <div class="text-sm text-blue-800">‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                    </div>
                    <div class="bg-purple-100 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-purple-600">${totalRequesters}</div>
                        <div class="text-sm text-purple-800">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏ö‡∏¥‡∏Å</div>
                    </div>
                    <div class="bg-yellow-100 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-yellow-600">${stats.pending}</div>
                        <div class="text-sm text-yellow-800">‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</div>
                    </div>
                    <div class="bg-green-100 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-green-600">${stats.approved}</div>
                        <div class="text-sm text-green-800">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</div>
                    </div>
                    <div class="bg-red-100 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-red-600">${stats.rejected}</div>
                        <div class="text-sm text-red-800">‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</div>
                    </div>
                </div>
                
                <!-- ‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <div class="bg-white border rounded-lg p-4">
                        <h3 class="font-semibold mb-4 text-center">üìä ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏≥‡∏Ç‡∏≠</h3>
                        <div class="relative h-64">
                            <canvas id="statusChart"></canvas>
                        </div>
                    </div>
                    <div class="bg-white border rounded-lg p-4">
                        <h3 class="font-semibold mb-4 text-center">üè¢ ‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô‡∏Å</h3>
                        <div class="relative h-64">
                            <canvas id="departmentChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <div class="bg-white border rounded-lg p-4">
                        <h3 class="font-semibold mb-4 text-center">üìù ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏° (Top 5)</h3>
                        <div class="relative h-64">
                            <canvas id="itemChart"></canvas>
                        </div>
                    </div>
                    <div class="bg-white border rounded-lg p-4">
                        <h3 class="font-semibold mb-4 text-center">üë• ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏ö‡∏¥‡∏Å‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô‡∏Å</h3>
                        <div class="relative h-64">
                            <canvas id="requesterChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-white border rounded-lg p-4">
                        <h3 class="font-semibold mb-3">üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô‡∏Å</h3>
                        ${Object.keys(departmentStats).length > 0 ? 
                            Object.entries(departmentStats)
                                .sort((a, b) => b[1] - a[1])
                                .map(([dept, count]) => `
                                    <div class="flex justify-between py-2 border-b">
                                        <span>${dept}</span>
                                        <span class="font-semibold">${count} ‡∏Ñ‡∏≥‡∏Ç‡∏≠</span>
                                    </div>
                                `).join('') 
                            : '<div class="text-center py-4 text-gray-500">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>'
                        }
                    </div>
                    <div class="bg-white border rounded-lg p-4">
                        <h3 class="font-semibold mb-3">üë• ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏ö‡∏¥‡∏Å‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô‡∏Å</h3>
                        ${Object.keys(requestersByDept).length > 0 ? 
                            Object.entries(requestersByDept)
                                .sort((a, b) => b[1].size - a[1].size)
                                .map(([dept, requesters]) => `
                                    <div class="flex justify-between py-2 border-b">
                                        <span>${dept}</span>
                                        <span class="font-semibold">${requesters.size} ‡∏Ñ‡∏ô</span>
                                    </div>
                                `).join('')
                            : '<div class="text-center py-4 text-gray-500">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>'
                        }
                    </div>
                </div>
            `;

            // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏≠‡∏á‡πÑ‡∏ß‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å
            window.currentFilteredData = {
                data: filteredRequisitions,
                dateRange: {
                    start: startDate.toLocaleDateString('th-TH'),
                    end: endDate.toLocaleDateString('th-TH')
                }
            };

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏≤‡∏ü‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡πà HTML ‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß
            setTimeout(() => {
                createCharts(stats, departmentStats, requestersByDept, topItems);
            }, 100);
        }

        function exportFilteredData() {
            if (window.currentFilteredData && window.currentFilteredData.data.length > 0) {
                createExcelFile(window.currentFilteredData.data, window.currentFilteredData.dateRange);
            } else {
                alert('‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å');
            }
        }

        function createSampleData() {
            const today = new Date();
            const sampleData = [];
            
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á 15 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
            const sampleNames = [
                '‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ', '‡∏™‡∏°‡∏´‡∏ç‡∏¥‡∏á ‡∏£‡∏±‡∏Å‡∏á‡∏≤‡∏ô', '‡∏ß‡∏¥‡∏ä‡∏±‡∏¢ ‡πÄ‡∏Å‡πà‡∏á‡∏á‡∏≤‡∏ô', '‡∏ô‡∏¥‡∏î‡∏≤ ‡∏Ç‡∏¢‡∏±‡∏ô‡∏ó‡∏≥', '‡∏õ‡∏£‡∏∞‡∏¢‡∏∏‡∏ó‡∏ò‡πå ‡∏°‡∏≤‡∏ô‡∏∞',
                '‡∏™‡∏∏‡∏î‡∏≤ ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', '‡∏≠‡∏ô‡∏∏‡∏ä‡∏≤ ‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏à', '‡∏°‡∏≤‡∏•‡∏µ ‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°', '‡∏ö‡∏∏‡∏ç‡∏°‡∏µ ‡∏î‡∏µ‡πÉ‡∏à', '‡∏ä‡∏±‡∏¢‡∏¢‡∏≤ ‡∏ä‡∏ô‡∏∞‡πÉ‡∏à',
                '‡∏ò‡∏ô‡∏≤ ‡πÄ‡∏à‡∏£‡∏¥‡∏ç', '‡∏õ‡∏¥‡∏¢‡∏∞ ‡∏™‡∏∏‡∏Ç‡πÉ‡∏™', '‡∏£‡∏±‡∏ä‡∏ô‡∏µ ‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à', '‡∏™‡∏°‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå ‡∏†‡∏π‡∏°‡∏¥‡πÉ‡∏à', '‡∏ß‡∏±‡∏ô‡∏î‡∏µ ‡∏°‡∏µ‡∏™‡∏∏‡∏Ç'
            ];
            
            const departments = [
                '‡∏ù‡πà‡∏≤‡∏¢ IT', '‡∏ù‡πà‡∏≤‡∏¢ HR', '‡∏ù‡πà‡∏≤‡∏¢ Account', '‡∏ù‡πà‡∏≤‡∏¢ CS', '‡∏ù‡πà‡∏≤‡∏¢ Cosmetic',
                '‡∏ù‡πà‡∏≤‡∏¢ ‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤', '‡∏ù‡πà‡∏≤‡∏¢ ‡∏à‡∏±‡∏î‡∏ã‡∏∑‡πâ‡∏≠', '‡∏ù‡πà‡∏≤‡∏¢ ‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°', '‡∏ù‡πà‡∏≤‡∏¢ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û'
            ];
            
            const purposes = ['‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥', '‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡πÄ‡∏®‡∏©', '‡∏á‡∏≤‡∏ô‡∏î‡πà‡∏ß‡∏ô', '‡∏ó‡∏î‡πÅ‡∏ó‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢'];
            const urgencies = ['‡∏õ‡∏Å‡∏ï‡∏¥', '‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô', '‡∏î‡πà‡∏ß‡∏ô‡∏°‡∏≤‡∏Å'];
            const statuses = ['‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥', '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß', '‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥'];
            
            const sampleItems = [
                { item: '‡∏õ‡∏≤‡∏Å‡∏Å‡∏≤‡∏•‡∏π‡∏Å‡∏•‡∏∑‡πà‡∏ô', quantity: 5, unit: '‡∏ä‡∏¥‡πâ‡∏ô' },
                { item: '‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© A4', quantity: 2, unit: '‡πÅ‡∏û‡πá‡∏Ñ' },
                { item: '‡πÅ‡∏ü‡πâ‡∏°', quantity: 10, unit: '‡πÄ‡∏•‡πà‡∏°' },
                { item: '‡∏î‡∏¥‡∏ô‡∏™‡∏≠', quantity: 12, unit: '‡∏ä‡∏¥‡πâ‡∏ô' },
                { item: '‡∏¢‡∏≤‡∏á‡∏•‡∏ö', quantity: 3, unit: '‡∏ä‡∏¥‡πâ‡∏ô' },
                { item: '‡πÑ‡∏°‡πâ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î', quantity: 2, unit: '‡∏ä‡∏¥‡πâ‡∏ô' },
                { item: '‡∏Å‡∏£‡∏£‡πÑ‡∏Å‡∏£', quantity: 1, unit: '‡∏ä‡∏¥‡πâ‡∏ô' },
                { item: '‡∏Å‡∏≤‡∏ß', quantity: 4, unit: '‡∏ä‡∏¥‡πâ‡∏ô' },
                { item: '‡πÄ‡∏ó‡∏õ', quantity: 3, unit: '‡∏°‡πâ‡∏ß‡∏ô' },
                { item: '‡∏Ñ‡∏•‡∏¥‡∏õ', quantity: 1, unit: '‡∏Å‡∏•‡πà‡∏≠‡∏á' }
            ];
            
            for (let i = 0; i < 15; i++) {
                const randomDate = new Date(today.getTime() - Math.random() * 30 * 24 * 60 * 60 * 1000);
                const department = departments[Math.floor(Math.random() * departments.length)];
                
                // ‡∏™‡∏∏‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå 1-4 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                const numItems = Math.floor(Math.random() * 4) + 1;
                const selectedItems = [];
                for (let j = 0; j < numItems; j++) {
                    const randomItem = sampleItems[Math.floor(Math.random() * sampleItems.length)];
                    selectedItems.push({
                        item: randomItem.item,
                        quantity: Math.floor(Math.random() * randomItem.quantity) + 1,
                        unit: randomItem.unit
                    });
                }
                
                sampleData.push({
                    id: Date.now() + i,
                    employeeName: sampleNames[i],
                    department: department,
                    employeeId: `EMP${String(i + 1).padStart(3, '0')}`,
                    purpose: purposes[Math.floor(Math.random() * purposes.length)],
                    urgency: urgencies[Math.floor(Math.random() * urgencies.length)],
                    notes: Math.random() > 0.5 ? '‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥' : '',
                    items: selectedItems,
                    approver: getApproverEmail(department),
                    status: statuses[Math.floor(Math.random() * statuses.length)],
                    requestDate: randomDate.toLocaleDateString('th-TH'),
                    requestTime: randomDate.toLocaleTimeString('th-TH')
                });
            }
            
            return sampleData;
        }

        function generateSampleReport() {
            const sampleData = createSampleData();
            const today = new Date();
            const thirtyDaysAgo = new Date(today.getTime() - (30 * 24 * 60 * 60 * 1000));
            
            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ 30 ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤
            document.getElementById('startDate').value = thirtyDaysAgo.toISOString().split('T')[0];
            document.getElementById('endDate').value = today.toISOString().split('T')[0];
            
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
            generateStatsFromData(sampleData, thirtyDaysAgo, today);
        }

        function generateStatsFromData(data, startDate, endDate) {
            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
            const stats = {
                total: data.length,
                pending: data.filter(r => r.status === '‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥').length,
                approved: data.filter(r => r.status === '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß').length,
                rejected: data.filter(r => r.status === '‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥').length
            };

            const uniqueRequesters = new Set(data.map(req => req.employeeId));
            const totalRequesters = uniqueRequesters.size;

            const departmentStats = {};
            const requestersByDept = {};
            
            data.forEach(req => {
                departmentStats[req.department] = (departmentStats[req.department] || 0) + 1;
                
                if (!requestersByDept[req.department]) {
                    requestersByDept[req.department] = new Set();
                }
                requestersByDept[req.department].add(req.employeeId);
            });

            // ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°
            const itemStats = {};
            data.forEach(req => {
                req.items.forEach(item => {
                    itemStats[item.item] = (itemStats[item.item] || 0) + item.quantity;
                });
            });

            const topItems = Object.entries(itemStats)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);

            // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
            document.getElementById('statsResults').innerHTML = `
                <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å -->
                <div class="bg-orange-50 border border-orange-200 rounded-lg p-4 mb-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold text-orange-800">üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</h3>
                            <p class="text-sm text-orange-700">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: ${startDate.toLocaleDateString('th-TH')} - ${endDate.toLocaleDateString('th-TH')}</p>
                            <p class="text-xs text-orange-600 mt-1">‚ö†Ô∏è ‡∏ô‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö</p>
                        </div>
                        <div class="text-right">
                            <div class="text-sm text-orange-600">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</div>
                            <div class="text-lg font-bold text-orange-800">${data.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6">
                    <div class="bg-blue-100 p-4 rounded-lg text-center status-card">
                        <div class="text-2xl font-bold text-blue-600">${stats.total}</div>
                        <div class="text-sm text-blue-800">‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                    </div>
                    <div class="bg-purple-100 p-4 rounded-lg text-center status-card">
                        <div class="text-2xl font-bold text-purple-600">${totalRequesters}</div>
                        <div class="text-sm text-purple-800">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏ö‡∏¥‡∏Å</div>
                    </div>
                    <div class="bg-yellow-100 p-4 rounded-lg text-center status-card">
                        <div class="text-2xl font-bold text-yellow-600">${stats.pending}</div>
                        <div class="text-sm text-yellow-800">‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</div>
                    </div>
                    <div class="bg-green-100 p-4 rounded-lg text-center status-card">
                        <div class="text-2xl font-bold text-green-600">${stats.approved}</div>
                        <div class="text-sm text-green-800">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</div>
                    </div>
                    <div class="bg-red-100 p-4 rounded-lg text-center status-card">
                        <div class="text-2xl font-bold text-red-600">${stats.rejected}</div>
                        <div class="text-sm text-red-800">‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</div>
                    </div>
                </div>
                
                <!-- ‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <div class="bg-white border rounded-lg p-4">
                        <h3 class="font-semibold mb-4 text-center">üìä ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏≥‡∏Ç‡∏≠</h3>
                        <div class="relative h-64">
                            <canvas id="statusChart"></canvas>
                        </div>
                    </div>
                    <div class="bg-white border rounded-lg p-4">
                        <h3 class="font-semibold mb-4 text-center">üè¢ ‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô‡∏Å</h3>
                        <div class="relative h-64">
                            <canvas id="departmentChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <div class="bg-white border rounded-lg p-4">
                        <h3 class="font-semibold mb-4 text-center">üìù ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏° (Top 5)</h3>
                        <div class="relative h-64">
                            <canvas id="itemChart"></canvas>
                        </div>
                    </div>
                    <div class="bg-white border rounded-lg p-4">
                        <h3 class="font-semibold mb-4 text-center">üë• ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏ö‡∏¥‡∏Å‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô‡∏Å</h3>
                        <div class="relative h-64">
                            <canvas id="requesterChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-white border rounded-lg p-4">
                        <h3 class="font-semibold mb-3">üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô‡∏Å</h3>
                        ${Object.keys(departmentStats).length > 0 ? 
                            Object.entries(departmentStats)
                                .sort((a, b) => b[1] - a[1])
                                .map(([dept, count]) => `
                                    <div class="flex justify-between py-2 border-b">
                                        <span>${dept}</span>
                                        <span class="font-semibold">${count} ‡∏Ñ‡∏≥‡∏Ç‡∏≠</span>
                                    </div>
                                `).join('') 
                            : '<div class="text-center py-4 text-gray-500">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>'
                        }
                    </div>
                    <div class="bg-white border rounded-lg p-4">
                        <h3 class="font-semibold mb-3">üë• ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏ö‡∏¥‡∏Å‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô‡∏Å</h3>
                        ${Object.keys(requestersByDept).length > 0 ? 
                            Object.entries(requestersByDept)
                                .sort((a, b) => b[1].size - a[1].size)
                                .map(([dept, requesters]) => `
                                    <div class="flex justify-between py-2 border-b">
                                        <span>${dept}</span>
                                        <span class="font-semibold">${requesters.size} ‡∏Ñ‡∏ô</span>
                                    </div>
                                `).join('')
                            : '<div class="text-center py-4 text-gray-500">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>'
                        }
                    </div>
                </div>
            `;

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏≤‡∏ü‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡πà HTML ‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß
            setTimeout(() => {
                createCharts(stats, departmentStats, requestersByDept, topItems);
            }, 100);
        }

        function createCharts(stats, departmentStats, requestersByDept, topItems) {
            // ‡∏Å‡∏£‡∏≤‡∏ü‡∏ß‡∏á‡∏Å‡∏•‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏≥‡∏Ç‡∏≠
            const statusCtx = document.getElementById('statusChart');
            if (statusCtx) {
                new Chart(statusCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥', '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß', '‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥'],
                        datasets: [{
                            data: [stats.pending, stats.approved, stats.rejected],
                            backgroundColor: ['#FCD34D', '#10B981', '#EF4444'],
                            borderWidth: 2,
                            borderColor: '#ffffff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 20,
                                    font: {
                                        family: 'Sarabun'
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // ‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏ó‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô‡∏Å
            const deptCtx = document.getElementById('departmentChart');
            if (deptCtx) {
                const deptLabels = Object.keys(departmentStats).map(dept => dept.replace('‡∏ù‡πà‡∏≤‡∏¢ ', ''));
                const deptData = Object.values(departmentStats);
                
                new Chart(deptCtx, {
                    type: 'bar',
                    data: {
                        labels: deptLabels,
                        datasets: [{
                            label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏≥‡∏Ç‡∏≠',
                            data: deptData,
                            backgroundColor: '#3B82F6',
                            borderColor: '#1D4ED8',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    stepSize: 1
                                }
                            },
                            x: {
                                ticks: {
                                    maxRotation: 45,
                                    font: {
                                        size: 10
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // ‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏ó‡πà‡∏á‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°
            const itemCtx = document.getElementById('itemChart');
            if (itemCtx && topItems.length > 0) {
                new Chart(itemCtx, {
                    type: 'bar',
                    data: {
                        labels: topItems.map(item => item[0]),
                        datasets: [{
                            label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ö‡∏¥‡∏Å',
                            data: topItems.map(item => item[1]),
                            backgroundColor: '#10B981',
                            borderColor: '#059669',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    stepSize: 1
                                }
                            },
                            x: {
                                ticks: {
                                    maxRotation: 45,
                                    font: {
                                        size: 10
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // ‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏ó‡πà‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏ö‡∏¥‡∏Å‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô‡∏Å
            const requesterCtx = document.getElementById('requesterChart');
            if (requesterCtx) {
                const requesterLabels = Object.keys(requestersByDept).map(dept => dept.replace('‡∏ù‡πà‡∏≤‡∏¢ ', ''));
                const requesterData = Object.values(requestersByDept).map(set => set.size);
                
                new Chart(requesterCtx, {
                    type: 'bar',
                    data: {
                        labels: requesterLabels,
                        datasets: [{
                            label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏ö‡∏¥‡∏Å',
                            data: requesterData,
                            backgroundColor: '#8B5CF6',
                            borderColor: '#7C3AED',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    stepSize: 1
                                }
                            },
                            x: {
                                ticks: {
                                    maxRotation: 45,
                                    font: {
                                        size: 10
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96bcf64413457b66',t:'MTc1NDYzNDU5NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
